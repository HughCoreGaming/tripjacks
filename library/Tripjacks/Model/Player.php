<?php

/**
 * Tripjacks_Model_Player
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    ##PACKAGE##
 * @subpackage ##SUBPACKAGE##
 * @author     ##NAME## <##EMAIL##>
 * @version    SVN: $Id: Builder.php 7490 2010-03-29 19:53:27Z jwage $
 */
class Tripjacks_Model_Player extends Tripjacks_Model_BasePlayer {

    public function setUp() {

        $this->hasOne('Tripjacks_Model_Users', array(
            'local' => 'userid',
            'foreign' => 'userid'
        ));

        $this->hasOne('Tripjacks_Model_BookingPlayer', array(
            'local' => 'playerid',
            'foreign' => 'playerid'
        ));
        
                $this->hasOne('Tripjacks_Model_Attendance', array(
            'local' => 'playerid',
            'foreign' => 'playerid'
                )
        );
 

    }
    
       public function countId($urid) {
        $q = Doctrine_Query::create()
                ->select('COUNT(*) AS count')
                ->from('Tripjacks_Model_UserReset ur')
                ->where('ur.urid = ?', $urid);
        $result = $q->fetchArray();

        return $result[0]['count'];
    }
    
    
            public function getName2($bpid) {
        $q = Doctrine_Query::create()
                ->select('bp.name as player, bp.playerid as pid, p.propic')
                ->from('Tripjacks_Model_Player p')
                ->innerJoin('Tripjacks_Model_BookingPlayer bp')
                ->where('bp.booking_playerid = ?', $bpid);
        $result = $q->fetchArray();

        return $result;
    }


    public function playerfromPlaying($bpid) {
        $q = Doctrine_Query::create()
                ->select('player')
                ->from('Tripjacks_Model_Player p')
                ->innerJoin('p.Tripjacks_Model_BookingPlayer bp')
                ->where('bp.booking_gameid = ?', $bpid)
                ->addWhere('bp.playing = ?', "Yes");
        $result = $q->fetchArray();

        return $result;
    }
    
 public function getUserid2($memberno) {
        $q = Doctrine_Query::create()        
                ->from('Tripjacks_Model_Player p')
                ->innerJoin('p.Tripjacks_Model_Users u')
                ->where('p.memberno = ?', $memberno);
                
        $result = $q->fetchArray();

        return $result[0];
 }
    
    
            public function playerfromPlaying2($bpid) {
        $q = Doctrine_Query::create()
                ->from('Tripjacks_Model_BookingPlayer bp')
                ->innerJoin('bp.Tripjacks_Model_Player p')
                ->where('bp.booking_playerid = ?', $bpid);
        $result = $q->fetchArray();

        return $result;
    }

    public function getLeaguePlayers($vid) {
        $q = Doctrine_Query::create()
                ->from('Tripjacks_Model_Player p')
                ->innerJoin('p.Tripjacks_Model_Attendance a')
                ->where('a.venueid = ?', $vid);
        $result = $q->fetchArray();
        return $result;
    }
    
        public function getSpecialLeaguePlayers($slid) {
        $q = Doctrine_Query::create()
                ->from('Tripjacks_Model_BuyLeague bl')
                ->where('bl.sub_leagueid = ?', $slid);
        $result = $q->fetchArray();
        return $result;
    }
    
            public function countSpecialLeaguePlayers($slid, $pid) {
        $q = Doctrine_Query::create()
                ->from('Tripjacks_Model_BuyLeague bl')
                ->where('bl.sub_leagueid = ?', $slid)
                ->addWhere('bl.playerid =?', $pid);
        $result = count($q->fetchArray());
        return $result;
    }
    
        public function countGames($vid) {
        $q = Doctrine_Query::create()
                ->select('COUNT(date) as count')
                ->from('Tripjacks_Model_Games g')
                ->where('g.venueid = ?', $vid);
        $result = $q->fetchArray();
        return $result[0]['count'];
    }
    
    public function countLeaguePlayers($vid) {
        $q = Doctrine_Query::create()
                ->from('Tripjacks_Model_Player p')
                ->innerJoin('p.Tripjacks_Model_Attendance a')
                ->where('a.venueid = ?', $vid);
        $result = count($q->fetchArray());
        return $result;
    }

    public function getUserinfo($uid) {
        $q = Doctrine_Query::create()
                ->from('Tripjacks_Model_Users u')
                ->where('u.userid = ?', $uid);
        $result = $q->fetchArray();
        return $result;
    }
    
    public function getUserId($pid) {
        $q = Doctrine_Query::create()
                ->from('Tripjacks_Model_Player p')
                ->where('p.playerid = ?', $pid);
        $result = $q->fetchArray();
        
        return $result[0]['userid'];
    }
    
        public function getPics($pid) {
        $q = Doctrine_Query::create()
                ->from('Tripjacks_Model_Player p')
                ->where('p.playerid = ?', $pid);
        $result = $q->fetchArray();
        var_dump($result);
        exit;
        return $result['propic'];
    }

    public function getPlayerInfo($uid) {
        $q = Doctrine_Query::create()
                ->from('Tripjacks_Model_Player p')
                ->innerJoin('p.Tripjacks_Model_Users u')
                ->where('u.userid = ?', $uid);
        $result = $q->fetchArray();
        return $result;
    }
    
    public function getListofMemberno(){
         $q = Doctrine_Query::create()
                 ->addSelect('memberno')
               ->from('Tripjacks_Model_Player p')
                ->innerJoin('p.Tripjacks_Model_Users u')
                ->where('u.access = ?', 'player')
                 ->orderBy('p.memberno', 'ASC LIMIT 1');
        $result = $q->fetchArray();
        return $result;
    }
    
        public function getListofUsername(){
           $q = Doctrine_Query::create()
                ->addSelect('username')
                ->from('Tripjacks_Model_Users u')
                ->where('u.access = ?', 'player')
                ->orderBy('u.username', 'ASC LIMIT 1');
        $result = $q->execute();
        return $result;
    }
    
        public function getPlayer($pid) {
        $q = Doctrine_Query::create()
                ->from('Tripjacks_Model_Player p')
                ->where('p.playerid = ?', $pid);
        $result = $q->fetchArray();
        return $result;
    }
    
        public function getPlayerInfoWithoutUsers($uid) {
        $q = Doctrine_Query::create()
                ->from('Tripjacks_Model_Player p')
                ->where('p.userid = ?', $uid);
        $result = $q->fetchArray();
        return $result;
    }

    public function getVenueInfo($uid) {
        $q = Doctrine_Query::create()
                ->from('Tripjacks_Model_Venue v')
                ->innerJoin('v.Tripjacks_Model_Users u')
                ->where('u.userid = ?', $uid);
        $result = $q->fetchArray();
        return $result;
    }
    
        public function getVenueInfoWItoutUsers($uid) {
        $q = Doctrine_Query::create()
                ->from('Tripjacks_Model_Venue v')
                ->where('v.userid = ?', $uid);
        $result = $q->fetchArray();
        return $result;
    }
    
        public function getVenueid($uid) {
        $q = Doctrine_Query::create()
                ->from('Tripjacks_Model_Venue v')
                ->innerJoin('v.Tripjacks_Model_Users u')
                ->where('u.userid = ?', $uid);
        $result = $q->fetchArray();
        return $result[0]['venueid'];
    }
    
        public function getPlayerid($uid) {
        $q = Doctrine_Query::create()
                ->from('Tripjacks_Model_Player p')
                ->innerJoin('p.Tripjacks_Model_Users u')
                ->where('u.userid = ?', $uid);
        $result = $q->fetchArray();
        return $result[0];
    }

}